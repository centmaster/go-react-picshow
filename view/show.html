<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Picture Show</title>
    <link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link href="../css/css.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div class="show-area">
    <ul id="myTab" class="nav nav-tabs">
        <li class="active">
            <a href="#type1" data-toggle="tab">
                Type-1
            </a>
        </li>
        <li><a href="#type2" data-toggle="tab">Type-2</a></li>
        <li><a href="#type3" data-toggle="tab">Type-3</a></li>
    </ul>

    <div id="myTabContent" class="tab-content">
        <div class="tab-pane fade in active row" id="type1">
        </div>
        <div class="tab-pane fade" id="type2">

        </div>
        <div class="tab-pane fade" id="type3">

        </div>

    </div>
</div>

</body>
<script>

    window.onload=function () {

        getpos();
//        var pos=document.cookie.split(";");
//        for(var i=0;i<pos.length;i++) {
//            if(pos[i].trim().charAt(0)=='a'){
//                var position=pos[i].slice(pos[i].indexOf('=')+1);
//                var parent = document.getElementById('type1');
//                var insert = document.createElement('div');
//                insert.className = 'col-sm-12 col-md-6';
//                insert.innerHTML = '<a href="#" class="thumbnail"><img src="../' + position + '" alt="通用的占位符缩略图" data-pos="' + i + '"></a><div class="caption"><h3>可以填东西</h3></div>'
//                parent.appendChild(insert);
//
//
//                }
//            }

        }
    document.getElementById("type1").addEventListener("click",function(e) {
        //console.log(e.target);
        // 检查事件源e.targe是否为Li
        if(e.target && e.target.nodeName.toUpperCase() == "IMG") {
            //console.log(e.target.getAttribute('data-pos'));
            //在dom中删除节点
            var removenode = e.target.parentNode.parentNode;
            //document.getElementById('typ1').removeChild(e.target);
            document.getElementById("type1").removeChild(removenode);

            //发送ajax，在后台删除节点
            deleteitem(e.target.getAttribute('data-pos'));
             }
        });
    function deleteitem(x) {
        var xhr = new XMLHttpRequest();
        xhr.open('POST','/api?delete=' + x, true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200) {
                console.log('success');
            }
        }
        xhr.setRequestHeader("Content-Type", "application/json ;charset=utf-8");
        xhr.setRequestHeader("Accept", "application/json");
        xhr.setRequestHeader("Access-Control-Allow-Origin", "http://localhost");
        xhr.send();
    }

    function getpos() {
            var xhr = new XMLHttpRequest();
            xhr.open('GET','/api/getpos',true);
            xhr.onreadystatechange = function () {
                if(xhr.readyState == 4 && xhr.status == 200){
                    var res=JSON.parse(xhr.responseText);
                    var arr=res.slice(1,res.length-1).split(",");
                    //console.log(arr[10].charAt(arr[10].indexOf('/')+1));
                    for (var i=0;i<arr.length;i++){
                        if(arr[i].charAt(arr[i].indexOf('/')+1) == 1) {
                            var parent1 = document.getElementById('type1');
                            arr[i] = arr[i].slice(1, arr[i].length - 1);
                            var insert = document.createElement('div');
                            insert.className = 'col-sm-12 col-md-6';
                            insert.innerHTML = '<a href="#" class="thumbnail"><img src="../' + arr[i] + '" alt="通用的占位符缩略图" data-pos="' + i + '"></a><div class="caption"><h3>test</h3></div>'
                            parent1.appendChild(insert);
                        }else if(arr[i].charAt(arr[i].indexOf('/')+1) == 2){
                            var parent2 = document.getElementById('type2');
                            arr[i] = arr[i].slice(1, arr[i].length - 1);
                            var insert = document.createElement('div');
                            insert.className = 'col-sm-12 col-md-6';
                            insert.innerHTML = '<a href="#" class="thumbnail"><img src="../' + arr[i] + '" alt="通用的占位符缩略图" data-pos="' + i + '"></a><div class="caption"><h3>test</h3></div>'
                            parent2.appendChild(insert);
                        }else if(arr[i].charAt(arr[i].indexOf('/')+1) == 3){
                            var parent3 = document.getElementById('type3');
                            arr[i] = arr[i].slice(1, arr[i].length - 1);
                            var insert = document.createElement('div');
                            insert.className = 'col-sm-12 col-md-6';
                            insert.innerHTML = '<a href="#" class="thumbnail"><img src="../' + arr[i] + '" alt="通用的占位符缩略图" data-pos="' + i + '"></a><div class="caption"><h3>test</h3></div>'
                            parent3.appendChild(insert);
                        }
                    };

                }
            }
        xhr.setRequestHeader("Content-Type", "application/json ;charset=utf-8");
        xhr.setRequestHeader("Accept", "application/json");
        xhr.setRequestHeader("Access-Control-Allow-Origin", "http://localhost");
        xhr.send();
    }


</script>
</html>